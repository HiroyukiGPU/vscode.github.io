<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Language Code Typing Animation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            overflow: hidden;
        }

        .editor-wrapper {
            display: flex;
            height: calc(100vh - 42px);
            width: 100vw;
        }

        .line-numbers {
            background-color: #1e1e1e;
            color: #858585;
            padding: 20px 10px;
            text-align: right;
            user-select: none;
            min-width: 60px;
            border-right: 1px solid #2d2d30;
            font-size: 14px;
            line-height: 21px;
            overflow-y: auto;
            overflow-x: hidden;
            white-space: pre;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .line-numbers::-webkit-scrollbar {
            width: 0;
            display: none;
        }

        .code-area {
            flex: 1;
            background-color: #1e1e1e;
            padding: 20px;
            overflow-y: auto;
            overflow-x: auto;
            font-size: 14px;
            line-height: 21px;
            white-space: pre;
            position: relative;
            tab-size: 4;
            -moz-tab-size: 4;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .code-area::-webkit-scrollbar {
            width: 0;
            height: 0;
            display: none;
        }

        .cursor {
            display: inline-block;
            width: 2px;
            height: 18px;
            background-color: #ffffff;
            animation: blink 1s infinite;
            position: relative;
            top: 3px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Syntax Highlighting */
        .keyword { color: #569cd6; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; font-style: italic; }
        .function { color: #dcdcaa; }
        .number { color: #b5cea8; }
        .class-name { color: #4ec9b0; }
        .property { color: #9cdcfe; }
        .operator { color: #d4d4d4; }
        .punctuation { color: #d4d4d4; }
        .auto-complete { color: #6e6e6e; }
        
        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d30 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-content {
            text-align: center;
            color: #d4d4d4;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 30px;
            border: 4px solid #2d2d30;
            border-top: 4px solid #569cd6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-title {
            font-size: 24px;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #569cd6, #4ec9b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .loading-text {
            font-size: 14px;
            color: #858585;
            margin-bottom: 25px;
            min-height: 20px;
        }
        
        .loading-bar {
            width: 300px;
            height: 4px;
            background-color: #2d2d30;
            border-radius: 2px;
            overflow: hidden;
            margin: 0 auto;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #569cd6, #4ec9b0);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 class="loading-title">Detecting Code Files...</h2>
            <p class="loading-text" id="loadingText">Scanning for files...</p>
            <div class="loading-bar">
                <div class="loading-progress" id="loadingProgress"></div>
            </div>
        </div>
    </div>
    
    <div class="editor-wrapper">
        <div class="line-numbers" id="lineNumbers">1</div>
        <div class="code-area" id="codeArea"></div>
    </div>

    <script>
        // Ëá™ÂãïÊ§úÂá∫„Åï„Çå„ÇãÊã°ÂºµÂ≠ê„É™„Çπ„Éà
        const possibleExtensions = [
            'py', 'java', 'js', 'c', 'cpp', 'cs', 'php', 'kt', 'rb', 'go',
            'sql', 'ts', 'sh', 'rs', 'dart', 'asm', 'swift', 'r', 'vb',
            'html', 'css', 'pl', 'd', 'txt'
        ];
        
        let codeFiles = []; // ÂãïÁöÑ„Å´Ê§úÂá∫„Åï„Çå„Åü„Éï„Ç°„Ç§„É´„É™„Çπ„Éà
        let currentFileIndex = 0;
        let fullCode = '';
        let currentIndex = 0;
        let typingSpeed = 20; // „Éü„É™ÁßíÔºà20ms = 50ÊñáÂ≠ó/ÁßíÔºâ
        let typingInterval = null;
        let displayedCode = ''; // ÂÆüÈöõ„Å´Ë°®Á§∫„Åï„Çå„Çã„Ç≥„Éº„ÉâÔºàËá™ÂãïË£úÂÆåÂê´„ÇÄÔºâ
        let autoCompletedChars = 0; // Ëá™ÂãïË£úÂÆå„ÅßËøΩÂä†„Åï„Çå„ÅüÊñáÂ≠óÊï∞
        let currentLanguage = 'javascript'; // ÁèæÂú®„ÅÆË®ÄË™û
        
        // „Éï„Ç°„Ç§„É´Êã°ÂºµÂ≠ê„Åã„ÇâË®ÄË™û„ÇíÂà§ÂÆö
        function detectLanguage(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const langMap = {
                'py': 'python',
                'java': 'java',
                'js': 'javascript',
                'c': 'c',
                'cpp': 'cpp',
                'cc': 'cpp',
                'cxx': 'cpp',
                'cs': 'csharp',
                'php': 'php',
                'kt': 'kotlin',
                'rb': 'ruby',
                'go': 'go',
                'sql': 'sql',
                'ts': 'typescript',
                'sh': 'shell',
                'bash': 'shell',
                'rs': 'rust',
                'dart': 'dart',
                'asm': 'assembly',
                's': 'assembly',
                'swift': 'swift',
                'r': 'r',
                'vb': 'vb',
                'html': 'html',
                'htm': 'html',
                'css': 'css',
                'pl': 'perl',
                'd': 'd'
            };
            return langMap[ext] || 'javascript';
        }

        // ÁèæÂú®„ÅÆ„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„ÇÄ
        async function loadCurrentFile() {
            const fileName = codeFiles[currentFileIndex];
            currentLanguage = detectLanguage(fileName);
            console.log(`üìÇ Loading file: ${fileName} (${currentFileIndex + 1}/${codeFiles.length}) - Language: ${currentLanguage}`);
            
            try {
                const response = await fetch(fileName);
                if (!response.ok) {
                    throw new Error(`File not found: ${fileName}`);
                }
                
                let code = await response.text();
                
                // Ë°åÈ†≠„ÅÆ„Çπ„Éö„Éº„Çπ„Çí„Çø„Éñ„Å´Â§âÊèõÔºà2„Çπ„Éö„Éº„Çπ„ÄÅ4„Çπ„Éö„Éº„Çπ„ÄÅ8„Çπ„Éö„Éº„ÇπÁ≠âÔºâ
                code = code.split('\n').map(line => {
                    // Ë°åÈ†≠„ÅÆ„Çπ„Éö„Éº„Çπ„ÇíÊï∞„Åà„Çã
                    const match = line.match(/^( +)/);
                    if (match) {
                        const spaces = match[1].length;
                        // 2„Çπ„Éö„Éº„Çπ„Åî„Å®„Å´1„Çø„Éñ„Å´Â§âÊèõÔºà„Åæ„Åü„ÅØ4„Çπ„Éö„Éº„Çπ„Åî„Å®Ôºâ
                        const tabs = '\t'.repeat(Math.floor(spaces / 2));
                        const remainingSpaces = ' '.repeat(spaces % 2);
                        return tabs + remainingSpaces + line.substring(spaces);
                    }
                    return line;
                }).join('\n');
                
                fullCode = code;
                currentIndex = 0;
                displayedCode = '';
                autoCompletedChars = 0;
                
                startTyping();
            } catch (error) {
                console.error(`„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${fileName}`, error);
                fullCode = `// „Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${fileName}\n// „Éï„Ç°„Ç§„É´„ÅåÂêå„Åò„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
                currentIndex = 0;
                displayedCode = '';
                autoCompletedChars = 0;
                
                startTyping();
            }
        }
        
        // Ê¨°„ÅÆ„Éï„Ç°„Ç§„É´„Å´ÁßªÂãï
        function loadNextFile() {
            currentFileIndex = (currentFileIndex + 1) % codeFiles.length;
            console.log(`‚û°Ô∏è Moving to next file (${currentFileIndex + 1}/${codeFiles.length})`);
            
            // ÁîªÈù¢„Çí„ÇØ„É™„Ç¢
            document.getElementById('codeArea').innerHTML = '';
            document.getElementById('lineNumbers').textContent = '1';
            
            // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÊ¨°„ÅÆ„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
            setTimeout(() => {
                loadCurrentFile();
            }, 1000);
        }
        
        // ÂØæÂøú„Åô„ÇãÈñâ„ÅòÊã¨Âºß„ÇíÂèñÂæó
        function getClosingBracket(char) {
            const brackets = {
                '(': ')',
                '{': '}',
                '[': ']'
            };
            return brackets[char] || null;
        }
        
        // ÂêÑË®ÄË™û„ÅÆ„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂèñÂæó
        function getLanguageKeywords(lang) {
            const keywords = {
                javascript: 'class|constructor|function|const|let|var|if|else|for|while|return|new|this|try|catch|throw|async|await|import|export|from|default|extends|static|get|set|case|switch|break|continue|do|typeof|instanceof|delete|void|yield|in|of',
                typescript: 'class|constructor|function|const|let|var|if|else|for|while|return|new|this|try|catch|throw|async|await|import|export|from|default|extends|static|get|set|case|switch|break|continue|do|typeof|instanceof|delete|void|yield|in|of|interface|type|enum|namespace|abstract|implements|private|public|protected|readonly',
                python: 'def|class|if|elif|else|for|while|return|import|from|as|try|except|finally|raise|with|lambda|yield|async|await|pass|break|continue|and|or|not|in|is|None|True|False|self',
                java: 'class|interface|extends|implements|public|private|protected|static|final|abstract|void|int|long|short|byte|float|double|boolean|char|String|if|else|for|while|do|switch|case|return|new|this|super|try|catch|finally|throw|throws|import|package|synchronized|volatile|transient',
                c: 'int|long|short|char|float|double|void|unsigned|signed|struct|union|enum|typedef|sizeof|if|else|for|while|do|switch|case|return|break|continue|goto|static|extern|const|volatile|auto|register',
                cpp: 'int|long|short|char|float|double|void|unsigned|signed|bool|class|struct|union|enum|namespace|template|typename|public|private|protected|virtual|friend|operator|new|delete|this|nullptr|if|else|for|while|do|switch|case|return|break|continue|try|catch|throw|const|static|extern|inline|constexpr|auto',
                csharp: 'class|interface|struct|enum|namespace|using|public|private|protected|internal|static|readonly|const|virtual|override|abstract|sealed|partial|void|int|long|short|byte|float|double|decimal|bool|char|string|object|var|if|else|for|foreach|while|do|switch|case|return|new|this|base|try|catch|finally|throw|async|await',
                php: 'class|interface|trait|extends|implements|public|private|protected|static|final|abstract|function|if|else|elseif|for|foreach|while|do|switch|case|return|new|this|parent|self|try|catch|finally|throw|use|namespace|echo|print|include|require|array|null|true|false',
                kotlin: 'class|interface|object|fun|val|var|if|else|when|for|while|do|return|this|super|null|true|false|is|in|as|try|catch|finally|throw|public|private|protected|internal|open|abstract|override|sealed|data|companion|init',
                ruby: 'class|module|def|if|elsif|else|unless|case|when|for|while|until|do|end|return|yield|self|super|true|false|nil|begin|rescue|ensure|raise|and|or|not|in',
                go: 'func|var|const|type|struct|interface|package|import|if|else|for|range|switch|case|return|defer|go|chan|select|break|continue|fallthrough|goto|true|false|nil',
                sql: 'SELECT|FROM|WHERE|JOIN|INNER|LEFT|RIGHT|OUTER|ON|AND|OR|NOT|IN|LIKE|BETWEEN|ORDER|BY|GROUP|HAVING|INSERT|INTO|VALUES|UPDATE|SET|DELETE|CREATE|TABLE|ALTER|DROP|INDEX|VIEW|DATABASE|PRIMARY|KEY|FOREIGN|REFERENCES|NULL|DEFAULT|CONSTRAINT|UNION|DISTINCT|COUNT|SUM|AVG|MIN|MAX',
                shell: 'if|then|else|elif|fi|case|esac|for|while|until|do|done|function|return|exit|break|continue|echo|printf|read|export|local|declare|set|unset|true|false',
                rust: 'fn|let|mut|const|static|if|else|match|loop|while|for|in|return|break|continue|struct|enum|impl|trait|type|where|pub|mod|use|crate|self|super|async|await|move|ref|true|false|None|Some',
                dart: 'class|interface|extends|implements|mixin|abstract|enum|void|var|final|const|if|else|for|while|do|switch|case|return|new|this|super|try|catch|finally|throw|rethrow|async|await|yield|import|export|library|part|true|false|null',
                assembly: 'mov|push|pop|add|sub|mul|div|inc|dec|jmp|je|jne|jg|jl|call|ret|int|lea|cmp|test|and|or|xor|not|shl|shr|nop',
                swift: 'class|struct|enum|protocol|extension|func|var|let|if|else|guard|switch|case|for|while|repeat|return|break|continue|fallthrough|self|super|init|deinit|true|false|nil|import|public|private|internal|fileprivate|static|mutating|throws|try|catch|async|await',
                r: 'function|if|else|for|while|repeat|break|next|return|in|TRUE|FALSE|NULL|NA|NaN|Inf|library|require|source',
                vb: 'Class|Module|Function|Sub|If|Then|Else|ElseIf|End|For|To|Step|Next|While|Do|Loop|Until|Select|Case|Return|New|Me|MyBase|True|False|Nothing|Public|Private|Protected|Friend|Shared|Dim|As|Integer|String|Boolean|Double|Imports|Namespace',
                html: 'DOCTYPE|html|head|body|title|meta|link|script|style|div|span|a|img|ul|ol|li|table|tr|td|th|form|input|button|select|option|textarea|label|header|footer|nav|section|article|aside|main|figure|figcaption',
                css: 'absolute|animation|background|border|bottom|box|calc|center|class|color|content|display|fixed|flex|float|font|grid|height|hover|id|inline|left|margin|max|min|opacity|padding|position|relative|right|rotate|scale|shadow|static|text|top|transform|transition|translate|width',
                perl: 'if|else|elsif|unless|while|until|for|foreach|do|sub|my|our|local|return|use|require|package|new|bless|shift|unshift|push|pop|keys|values|each|grep|map|sort|split|join|print|say|chomp|chop|defined|undef',
                d: 'import|module|class|struct|interface|enum|union|function|void|int|float|double|char|bool|if|else|for|while|do|foreach|switch|case|break|continue|return|auto|const|immutable|pure|nothrow|ref|out|in|body|unittest|assert|static|final|override|abstract|public|private|protected|package'
            };
            return keywords[lang] || keywords.javascript;
        }
        
        // ÂêÑË®ÄË™û„ÅÆ„Ç≥„É°„É≥„ÉàÊßãÊñá„ÇíÂèñÂæó
        function getCommentPatterns(lang) {
            const patterns = {
                python: { line: '#', block: null },
                ruby: { line: '#', block: null },
                shell: { line: '#', block: null },
                r: { line: '#', block: null },
                sql: { line: '--', block: { start: '/\\*', end: '\\*/' } },
                vb: { line: "'", block: null },
                assembly: { line: ';', block: null },
                perl: { line: '#', block: { start: '=begin', end: '=cut' } },
                html: { line: null, block: { start: '<!--', end: '-->' } },
                css: { line: null, block: { start: '/\\*', end: '\\*/' } },
                d: { line: '//', block: { start: '/\\*', end: '\\*/' } }
            };
            return patterns[lang] || { line: '//', block: { start: '/\\*', end: '\\*/' } };
        }

        // „Ç∑„É≥„Çø„ÉÉ„ÇØ„Çπ„Éè„Ç§„É©„Ç§„Éà
        function highlightSyntax(code) {
            // TAB„Çí‰øùË≠∑„Åô„Çã„Åü„ÇÅ„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº
            const tabPlaceholder = '___TAB___';
            code = code.replace(/\t/g, tabPlaceholder);
            
            // „Ç®„Çπ„Ç±„Éº„ÉóÂá¶ÁêÜÔºàÊúÄÂàù„Å´Ë°å„ÅÜÔºâ
            code = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            // ‰∏ÄÊôÇÁöÑ„Å™„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Çí‰ΩøÁî®
            const placeholder = '___PLACEHOLDER___';
            const protectedParts = [];
            
            // „Ç≥„É°„É≥„ÉàÊßãÊñá„ÇíÂèñÂæó
            const commentPatterns = getCommentPatterns(currentLanguage);
            
            // „Ç≥„É°„É≥„Éà„Çí‰øùË≠∑
            if (commentPatterns.block) {
                // „Éñ„É≠„ÉÉ„ÇØ„Ç≥„É°„É≥„Éà
                const blockPattern = new RegExp(`${commentPatterns.block.start}[\\s\\S]*?${commentPatterns.block.end}`, 'gm');
                code = code.replace(blockPattern, (match) => {
                    const index = protectedParts.length;
                    protectedParts.push(`<span class="comment">${match}</span>`);
                    return `${placeholder}${index}${placeholder}`;
                });
            }
            
            // Ë°å„Ç≥„É°„É≥„Éà
            if (commentPatterns.line) {
                const lineCommentEscaped = commentPatterns.line.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const linePattern = new RegExp(`${lineCommentEscaped}.*?$`, 'gm');
                code = code.replace(linePattern, (match) => {
                    const index = protectedParts.length;
                    protectedParts.push(`<span class="comment">${match}</span>`);
                    return `${placeholder}${index}${placeholder}`;
                });
            }
            
            // ÊñáÂ≠óÂàó„Çí‰øùË≠∑ÔºàË®ÄË™û„Å´Âøú„Åò„Å¶Ë™øÊï¥Ôºâ
            let stringPattern;
            if (currentLanguage === 'python' || currentLanguage === 'ruby') {
                // Python/Ruby„ÅØ'„ÄÅ"„ÄÅ'''„ÄÅ"""„Çí„Çµ„Éù„Éº„Éà
                stringPattern = /('''[\s\S]*?'''|"""[\s\S]*?"""|'(?:[^'\\]|\\.)*?'|"(?:[^"\\]|\\.)*?")/g;
            } else if (currentLanguage === 'php') {
                // PHP„ÅØ$„ÇíÂê´„ÇÄÂ§âÊï∞„ÇÇ„Çµ„Éù„Éº„Éà
                stringPattern = /('(?:[^'\\]|\\.)*?'|"(?:[^"\\]|\\.)*?")/g;
            } else {
                // ‰∏ÄËà¨ÁöÑ„Å™ÊñáÂ≠óÂàó„Éë„Çø„Éº„É≥
                stringPattern = /(['"`])((?:\\.|(?!\1)[^\\])*?)\1/g;
            }
            
            code = code.replace(stringPattern, (match) => {
                const index = protectedParts.length;
                protectedParts.push(`<span class="string">${match}</span>`);
                return `${placeholder}${index}${placeholder}`;
            });
            
            // Ë®ÄË™û„ÅÆ„Ç≠„Éº„ÉØ„Éº„Éâ
            const keywords = getLanguageKeywords(currentLanguage);
            const keywordPattern = new RegExp(`\\b(${keywords})\\b`, 'g');
            code = code.replace(keywordPattern, '<span class="keyword">$1</span>');
            
            // Êï∞ÂÄ§
            code = code.replace(/\b(\d+\.?\d*|\.\d+|0x[0-9a-fA-F]+)\b/g, '<span class="number">$1</span>');
            
            // Èñ¢Êï∞ÂêçÔºàË®ÄË™û„Å´Âøú„Åò„Å¶Ë™øÊï¥Ôºâ
            if (currentLanguage === 'python') {
                code = code.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g, '<span class="function">$1</span>(');
            } else if (currentLanguage === 'assembly') {
                // „Ç¢„Çª„É≥„Éñ„É™„ÅØÁâπÂà•„Å™Âá¶ÁêÜ‰∏çË¶Å
            } else {
                code = code.replace(/\b([a-zA-Z_$][a-zA-Z0-9_$]*)\s*\(/g, '<span class="function">$1</span>(');
            }
            
            // „Éó„É≠„Éë„ÉÜ„Ç£ÔºàË®ÄË™û„Å´Âøú„Åò„Å¶Ôºâ
            if (currentLanguage !== 'assembly' && currentLanguage !== 'sql') {
                code = code.replace(/\.([a-zA-Z_$][a-zA-Z0-9_$]*)/g, '.<span class="property">$1</span>');
            }
            
            // ‰øùË≠∑„Åï„Çå„ÅüÈÉ®ÂàÜ„ÇíÂæ©ÂÖÉ
            code = code.replace(new RegExp(`${placeholder}(\\d+)${placeholder}`, 'g'), (match, index) => {
                return protectedParts[parseInt(index)];
            });
            
            // TAB„ÇíÂæ©ÂÖÉ
            code = code.replace(new RegExp(tabPlaceholder, 'g'), '\t');
            
            return code;
        }

        // „Çø„Ç§„Éî„É≥„Ç∞„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
        function typeCharacter() {
            if (currentIndex >= fullCode.length) {
                clearInterval(typingInterval);
                console.log('‚úÖ File completed! Moving to next file...');
                // „Éï„Ç°„Ç§„É´„ÅåÁµÇ„Çè„Å£„Åü„ÇâÊ¨°„ÅÆ„Éï„Ç°„Ç§„É´„Å´ÁßªÂãï
                loadNextFile();
                return;
            }

            // Ê¨°„ÅÆÊñáÂ≠ó„ÇíÂèñÂæó
            const nextChar = fullCode[currentIndex];
            currentIndex++;
            
            // Ëá™ÂãïË£úÂÆå„ÅßËøΩÂä†„Åï„Çå„ÅüÊñáÂ≠ó„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆÂá¶ÁêÜ
            if (autoCompletedChars > 0) {
                // Ëá™ÂãïË£úÂÆå„Åï„Çå„ÅüÈñâ„ÅòÊã¨Âºß„Åå„ÅÇ„Çã„ÅãÁ¢∫Ë™ç
                const autoCompletedPart = displayedCode.slice(-autoCompletedChars);
                
                // Ê¨°„ÅÆÊñáÂ≠ó„ÅåËá™ÂãïË£úÂÆå„Åï„Çå„ÅüÊúÄÂàù„ÅÆÊñáÂ≠ó„Å®‰∏ÄËá¥„Åô„ÇãÂ†¥Âêà
                // Ôºà„Å§„Åæ„ÇäÈñâ„ÅòÊã¨Âºß„ÇíÂÖ•Âäõ„Åô„ÇãÂ†¥ÂêàÔºâ
                if (nextChar === autoCompletedPart[0]) {
                    // Ëá™ÂãïË£úÂÆåÈÉ®ÂàÜ„Çí1ÊñáÂ≠óÂâäÈô§
                    displayedCode = displayedCode.slice(0, -autoCompletedChars) + nextChar + autoCompletedPart.substring(1);
                    autoCompletedChars--;
                } else {
                    // ‰ªñ„ÅÆÊñáÂ≠ó„ÇíÂÖ•Âäõ„Åô„ÇãÂ†¥Âêà„ÅØËá™ÂãïË£úÂÆå„ÇíÂÖ®ÂâäÈô§
                    displayedCode = displayedCode.slice(0, -autoCompletedChars);
                    autoCompletedChars = 0;
                    displayedCode += nextChar;
                }
            } else {
                // Ë°®Á§∫Áî®„Ç≥„Éº„Éâ„Å´ËøΩÂä†
                displayedCode += nextChar;
            }
            
            // Èñã„ÅçÊã¨Âºß„ÅÆÂ†¥Âêà„ÅØÂØæÂøú„Åô„ÇãÈñâ„ÅòÊã¨Âºß„ÇíËá™ÂãïËøΩÂä†
            const closingBracket = getClosingBracket(nextChar);
            
            if (closingBracket && autoCompletedChars === 0) {
                console.log('üî∑ Auto-completing:', nextChar, '‚Üí', closingBracket);
                displayedCode += closingBracket;
                autoCompletedChars = 1;
            }

            const codeArea = document.getElementById('codeArea');
            const lineNumbers = document.getElementById('lineNumbers');
            
            // „Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÇíË®àÁÆóÔºàËá™ÂãïË£úÂÆå„Åï„Çå„ÅüÊñáÂ≠ó„ÅÆÂâçÔºâ
            let codeBeforeCursor = displayedCode;
            let codeAfterCursor = '';
            
            if (autoCompletedChars > 0) {
                codeBeforeCursor = displayedCode.slice(0, -autoCompletedChars);
                codeAfterCursor = displayedCode.slice(-autoCompletedChars);
            }
            
            // „Éè„Ç§„É©„Ç§„Éà„ÇíÈÅ©Áî®„Åó„Å¶Ë°®Á§∫
            const highlightedBefore = highlightSyntax(codeBeforeCursor);
            let highlightedAfter = '';
            if (codeAfterCursor) {
                // Ëá™ÂãïË£úÂÆåÈÉ®ÂàÜ„Çí„Ç®„Çπ„Ç±„Éº„Éó„Åó„Å¶ÁÅ∞Ëâ≤„ÅßË°®Á§∫
                const escapedAfter = codeAfterCursor.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                highlightedAfter = '<span class="auto-complete">' + escapedAfter + '</span>';
            }
            codeArea.innerHTML = highlightedBefore + '<span class="cursor"></span>' + highlightedAfter;

            // Ë°åÁï™Âè∑„ÇíÊõ¥Êñ∞ÔºàÂÖÉ„ÅÆ„Ç≥„Éº„Éâ„ÅÆË°åÊï∞„ÅßÔºâ
            updateLineNumbers(fullCode.substring(0, currentIndex));

            // Ëá™Âãï„Çπ„ÇØ„É≠„Éº„É´ÔºàË°åÁï™Âè∑„ÇÇÂêåÊúüÔºâ
            codeArea.scrollTop = codeArea.scrollHeight;
            lineNumbers.scrollTop = lineNumbers.scrollHeight;
        }

        // Ë°åÁï™Âè∑„ÇíÊõ¥Êñ∞
        function updateLineNumbers(text) {
            const lines = text.split('\n');
            const currentLine = lines.length;
            
            const lineNumbers = document.getElementById('lineNumbers');
            let lineNumbersHtml = '';
            for (let i = 1; i <= currentLine; i++) {
                lineNumbersHtml += i + '\n';
            }
            lineNumbers.textContent = lineNumbersHtml;
        }

        // „Çø„Ç§„Éî„É≥„Ç∞ÈñãÂßã
        function startTyping() {
            if (typingInterval) {
                clearInterval(typingInterval);
            }
            typingInterval = setInterval(typeCharacter, typingSpeed);
        }

        // „Çπ„ÇØ„É≠„Éº„É´ÂêåÊúü„ÇíË®≠ÂÆö
        function setupScrollSync() {
            const codeArea = document.getElementById('codeArea');
            const lineNumbers = document.getElementById('lineNumbers');
            
            // „Ç≥„Éº„Éâ„Ç®„É™„Ç¢„Åå„Çπ„ÇØ„É≠„Éº„É´„Åï„Çå„Åü„ÇâË°åÁï™Âè∑„ÇÇÂêåÊúü
            codeArea.addEventListener('scroll', () => {
                lineNumbers.scrollTop = codeArea.scrollTop;
            });
        }
        
        // ÈÖçÂàó„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åô„ÇãÈñ¢Êï∞
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢„ÇíÊõ¥Êñ∞
        function updateLoadingProgress(percent, text) {
            const loadingText = document.getElementById('loadingText');
            const loadingProgress = document.getElementById('loadingProgress');
            
            if (loadingText) loadingText.textContent = text;
            if (loadingProgress) loadingProgress.style.width = percent + '%';
        }
        
        // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢„ÇíÈùûË°®Á§∫
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }
        }
        
        // ‰∏¶Âàó„Åß„Éï„Ç°„Ç§„É´„ÇíÊ§úÂá∫ÔºàÈ´òÈÄüÂåñÔºâ
        async function detectNumberedFiles() {
            console.log('üîç Êï∞Â≠ó„Éï„Ç°„Ç§„É´„ÇíËá™ÂãïÊ§úÂá∫‰∏≠...');
            updateLoadingProgress(10, 'Checking for random mode...');
            
            // 0.txt„ÅÆÂ≠òÂú®Á¢∫Ë™çÔºà„É©„É≥„ÉÄ„É†Âåñ„Éï„É©„Ç∞Ôºâ
            let randomizeOrder = false;
            try {
                const response = await fetch('0.txt', { method: 'HEAD' });
                if (response.ok) {
                    randomizeOrder = true;
                    console.log('üé≤ 0.txt„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü - „É©„É≥„ÉÄ„É†È†Ü„ÅßË°®Á§∫„Åó„Åæ„Åô');
                }
            } catch (error) {
                // 0.txt„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÈÄöÂ∏∏È†Ü
            }
            
            updateLoadingProgress(20, 'Scanning files in parallel...');
            
            // ‰∏¶ÂàóÊ§úÂá∫Ôºà1ÔΩû50„Åæ„Åß‰∏ÄÊ∞ó„Å´„ÉÅ„Çß„ÉÉ„ÇØÔºâ
            const maxFileNumber = 50;
            const checkPromises = [];
            
            for (let fileNumber = 1; fileNumber <= maxFileNumber; fileNumber++) {
                const promise = (async (num) => {
                    // ÂêÑÊã°ÂºµÂ≠ê„ÇíË©¶„Åô
                    for (const ext of possibleExtensions) {
                        const filename = `${num}.${ext}`;
                        
                        try {
                            const response = await fetch(filename, { method: 'HEAD' });
                            if (response.ok) {
                                return { number: num, filename };
                            }
                        } catch (error) {
                            // „Ç®„É©„Éº„ÅØÁÑ°Ë¶ñ
                        }
                    }
                    return null;
                })(fileNumber);
                
                checkPromises.push(promise);
            }
            
            updateLoadingProgress(40, 'Processing results...');
            
            // „Åô„Åπ„Å¶„ÅÆÁµêÊûú„ÇíÂæÖ„Å§
            const results = await Promise.all(checkPromises);
            
            updateLoadingProgress(60, 'Sorting files...');
            
            // null„ÇíÈô§Â§ñ„Åó„Å¶„ÇΩ„Éº„Éà
            const detectedFiles = results
                .filter(result => result !== null)
                .sort((a, b) => a.number - b.number)
                .map(result => result.filename);
            
            updateLoadingProgress(80, `Found ${detectedFiles.length} files...`);
            
            if (detectedFiles.length === 0) {
                console.error('‚ùå „Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                updateLoadingProgress(100, 'No files found!');
                alert('Ë°®Á§∫„Åô„Çã„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ\n1.py, 2.java, 3.js „Å™„Å©„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÈÖçÁΩÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return false;
            }
            
            console.log(`‚úì ${detectedFiles.length}ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÊ§úÂá∫„Åó„Åæ„Åó„Åü:`, detectedFiles);
            
            // 0.txt„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅØ„É©„É≥„ÉÄ„É†„Å´‰∏¶„Å≥Êõø„Åà
            if (randomizeOrder) {
                updateLoadingProgress(90, 'Randomizing order...');
                codeFiles = shuffleArray(detectedFiles);
                console.log(`üé≤ „É©„É≥„ÉÄ„É†È†Ü„Å´‰∏¶„Å≥Êõø„Åà„Åæ„Åó„Åü:`, codeFiles);
            } else {
                codeFiles = detectedFiles;
            }
            
            updateLoadingProgress(100, 'Ready to start!');
            
            return true;
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÈñãÂßã
        window.addEventListener('load', async () => {
            setupScrollSync();
            
            // „Éï„Ç°„Ç§„É´„ÇíËá™ÂãïÊ§úÂá∫
            const filesDetected = await detectNumberedFiles();
            
            if (filesDetected) {
                // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„Çâ„É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢„ÇíÈùûË°®Á§∫
                setTimeout(() => {
                    hideLoadingScreen();
                    // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢„ÅåÊ∂à„Åà„Å¶„Åã„ÇâÊúÄÂàù„ÅÆ„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
                    setTimeout(() => {
                        loadCurrentFile();
                    }, 300);
                }, 500);
            } else {
                hideLoadingScreen();
            }
        });
    </script>
</body>
</html>

